# bot.py
import os
import logging
import json
from telegram import Update
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    filters,
    ConversationHandler,
    ContextTypes,
)
import gspread
from oauth2client.service_account import ServiceAccountCredentials
from datetime import datetime

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
logger = logging.getLogger(__name__)

# –°–æ—Å—Ç–æ—è–Ω–∏—è –∞–Ω–∫–µ—Ç—ã
STEP_FIO, STEP_DATES, STEP_REGION, STEP_KNOWN, STEP_GOAL, STEP_CONTACT = range(6)

# –¢–∏–ø—ã –∫–µ–π—Å–æ–≤ –∏ —à–∞–±–ª–æ–Ω—ã
CASE_TEMPLATES = {
    "—Ä–µ–ø—Ä–µ—Å—Å–∏–∏": """
üß† Rodoslovnaya.pro —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç:

üóÇ –ß—Ç–æ –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å:
* —Å–ª–µ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–¥–æ–ø—Ä–æ—Å—ã, –æ–±–≤–∏–Ω–µ–Ω–∏–µ),
* –ø—Ä–∏–≥–æ–≤–æ—Ä (—á–∞—â–µ ‚Äî ¬´—Ç—Ä–æ–π–∫–æ–π –ù–ö–í–î¬ª),
* —Å–ø—Ä–∞–≤–∫–∞ –æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–∏ –ø—Ä–∏–≥–æ–≤–æ—Ä–∞ –≤ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ,
* —Å–ø—Ä–∞–≤–∫–∞ –æ —Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–∏.

üìÑ –ß—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
‚úÖ –¶–µ–ø–æ—á–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏—Ö —Ä–æ–¥—Å—Ç–≤–æ:
* —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ –∑–∞—è–≤–∏—Ç–µ–ª—è,
* —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è,
* —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ –±—Ä–∞–∫–µ ‚Äî –µ—Å–ª–∏ –º–µ–Ω—è–ª–∞—Å—å —Ñ–∞–º–∏–ª–∏—è.
üìé –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
* –ø–∞—Å–ø–æ—Ä—Ç –∑–∞—è–≤–∏—Ç–µ–ª—è (–∫–æ–ø–∏—è),
* –∑–∞—è–≤–ª–µ–Ω–∏–µ (–º—ã –≤—ã—à–ª–µ–º —à–∞–±–ª–æ–Ω),
* —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö.

üó∫ –ö—É–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è:
1. –í –£–§–°–ë –ø–æ —Ä–µ–≥–∏–æ–Ω—É —Å–ª–µ–¥—Å—Ç–≤–∏—è.
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–∏—Å—å–º–æ –ø–æ –ü–æ—á—Ç–µ –†–æ—Å—Å–∏–∏ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∏ –æ–ø–∏—Å—å—é –≤–ª–æ–∂–µ–Ω–∏—è.
3. –ò–ª–∏ —Å–¥–∞–π—Ç–µ –ª–∏—á–Ω–æ ‚Äî –µ—Å–ª–∏ –≤—ã –≤ —Ä–µ–≥–∏–æ–Ω–µ.

üìù –û–±—Ä–∞–∑–µ—Ü –∑–∞—è–≤–ª–µ–Ω–∏—è:
–ú—ã –≤—ã—à–ª–µ–º –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º.
–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—â–∏–π —à–∞–±–ª–æ–Ω: https://rodoslovnaya.pro/shtablon-ufsb.pdf

üåê –ü–æ–ª–µ–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏:
* –û—Ç–∫—Ä—ã—Ç—ã–π —Å–ø–∏—Å–æ–∫ / OpenList
* –ñ–µ—Ä—Ç–≤—ã –ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Ä—Ä–æ—Ä–∞ –≤ –°–°–°–†
* –ê—Ä—Ö–∏–≤ –Ø–Ω–¥–µ–∫—Å–∞
* –û–ë–î ¬´–ú–µ–º–æ—Ä–∏–∞–ª¬ª ‚Äî https://obd-memorial.ru

üì¨ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ rodoslovnaya.pro,
–Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ predki@rodoslovnaya.pro
–∏–ª–∏ –≤ Telegram: @rodoslovnaya_pro
    """,

    "–ø–ª–µ–Ω": """
üß† Rodoslovnaya.pro —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç:

üá∑üá∫ –í–æ–µ–Ω–Ω—ã–µ –∏ –ø–ª–µ–Ω–Ω—ã–µ:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –û–ë–î ¬´–ú–µ–º–æ—Ä–∏–∞–ª¬ª
üëâ https://obd-memorial.ru
–ò—â–∏—Ç–µ –ø–æ –§–ò–û –∏ –≥–æ–¥—É —Ä–æ–∂–¥–µ–Ω–∏—è. –û—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–æ, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –ø—Ä–æ–ø–∞–≤—à–∏–º –±–µ–∑ –≤–µ—Å—Ç–∏ –∏–ª–∏ –ø–æ–ø–∞–ª –≤ –ø–ª–µ–Ω ‚Äî —Ç–∞–º –º–æ–≥—É—Ç –±—ã—Ç—å:
    ‚Ä¢ —É—á–µ—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏,
    ‚Ä¢ –¥–æ–Ω–µ—Å–µ–Ω–∏—è –æ –ø–æ—Ç–µ—Ä—è—Ö,
    ‚Ä¢ —Å–ø–∏—Å–∫–∏ –æ–±–º–µ–Ω–∞ –∏ —Ç. –¥.

2. –ü–æ—Ä—Ç–∞–ª ¬´–ü–∞–º—è—Ç—å –Ω–∞—Ä–æ–¥–∞¬ª
üëâ https://pamyat-naroda.ru
–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏:
    ‚Ä¢ –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–∏–∑—ã–≤–µ,
    ‚Ä¢ —Å–ø–∏—Å–∫–∏ –ø–ª–µ–Ω–Ω—ã—Ö,
    ‚Ä¢ –∞—Ä—Ö–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ –≤–æ–µ–Ω–Ω–æ–π —Å–ª—É–∂–±–µ.

3. üá©üá™ Arolsen Archives (–±—ã–≤—à–∏–π WASt)
üëâ https://arolsen-archives.org
–û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –≤ –Ω–µ–º–µ—Ü–∫–æ–º –ø–ª–µ–Ω—É. –ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è:
    ‚Ä¢ –ª–∞–≥–µ—Ä–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (—à—Ç–∞–ª–∞–≥, –æ—Ñ–ª–∞–≥),
    ‚Ä¢ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è—Ö –∏ —Å—É–¥—å–±–µ –ø–ª–µ–Ω–Ω—ã—Ö.

üìå –î–ª—è –∑–∞–ø—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Arolsen –Ω—É–∂–Ω–æ:
‚Ä¢ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è,
‚Ä¢ –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∞–Ω–≥–ª. –∏–ª–∏ –Ω–µ–º. —è–∑—ã–∫–µ,
‚Ä¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–ª–æ–∂–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –º–µ—Å—Ç–µ –ø–ª–µ–Ω–µ–Ω–∏—è –∏–ª–∏ —Å–ª—É–∂–±–µ.

üßæ –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ –≤–æ–π–Ω—ã:
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ó–ê–ì–° –ø–æ –º–µ—Å—Ç—É —Å–º–µ—Ä—Ç–∏:
    ‚Ä¢ –ó–∞–ø—Ä–æ—Å–∏—Ç–µ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Å–º–µ—Ä—Ç–∏ ‚Äî –æ–Ω–æ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
        ‚Ä¢ –º–µ—Å—Ç–æ —Å–º–µ—Ä—Ç–∏,
        ‚Ä¢ –º–µ—Å—Ç–æ –∑–∞—Ö–æ—Ä–æ–Ω–µ–Ω–∏—è,
        ‚Ä¢ —Å—É–ø—Ä—É–≥–∞, –¥–µ—Ç–µ–π (–µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –æ—Ñ–æ—Ä–º–ª—è–ª),
        ‚Ä¢ –ø—Ä–∏—á–∏–Ω—É —Å–º–µ—Ä—Ç–∏.

5. ‚ö†Ô∏è –ï—Å–ª–∏ —Å –º–æ–º–µ–Ω—Ç–∞ —Å–º–µ—Ä—Ç–∏ –ø—Ä–æ—à–ª–æ < 100 –ª–µ—Ç ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–∫–∞–∑–∞—Ç—å —Ä–æ–¥—Å—Ç–≤–æ:
    ‚Ä¢ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ –º–∞—Ç–µ—Ä–∏,
    ‚Ä¢ –≤–∞—à–µ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏,
    ‚Ä¢ —Ü–µ–ø–æ—á–∫–∞ —Ä–æ–¥—Å—Ç–≤–∞.

üí° –ß—Ç–æ –µ—â—ë –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:
‚Ä¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –≥–æ—Ä–æ–¥—Å–∫–æ–π –∞—Ä—Ö–∏–≤ (—Ç—Ä—É–¥–æ–≤—ã–µ, –∞–¥—Ä–µ—Å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏).
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∞–π—Ç ¬´–ü–æ–¥–≤–∏–≥ –Ω–∞—Ä–æ–¥–∞¬ª ‚Äî –≤–¥—Ä—É–≥ –µ—Å—Ç—å –Ω–∞–≥—Ä–∞–¥—ã.
‚Ä¢ –°–¥–µ–ª–∞—Ç—å –î–ù–ö-—Ç–µ—Å—Ç –Ω–∞ Y-—Ö—Ä–æ–º–æ—Å–æ–º—É (—á–µ—Ä–µ–∑ —Å—ã–Ω–∞) ‚Äî —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –ø–æ—Ç–æ–º–∫–æ–≤.

üî¨ –ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
üß¨ Genotek ‚Äî –î–ù–ö-—Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤
–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º:
‚Ä¢ "–ù–∞–≤–∏–≥–∞—Ç–æ—Ä" ‚Äî –¥–ª—è –ø–æ–∏—Å–∫–∞ –¥–∞–ª—å–Ω–∏—Ö —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤;
‚Ä¢ "–ì–µ–Ω–µ–∞–ª–æ–≥–∏—è –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏ (Y-–î–ù–ö)" ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –º—É–∂—Å–∫—É—é –ª–∏–Ω–∏—é.

üì¨ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ rodoslovnaya.pro,
–Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ predki@rodoslovnaya.pro
–∏–ª–∏ –≤ Telegram: @rodoslovnaya_pro
    """,

    "–æ—Å—É–∂–¥—ë–Ω": """
üß† Rodoslovnaya.pro —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç:

üîç –®–∞–≥ 1. –ó–∞–ø—Ä–æ—Å —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ –≤ –ó–ê–ì–°
üìå –ü–æ—á–µ–º—É: –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ —É–∫–∞–∑–∞–Ω—ã –æ–±–∞ —Ä–æ–¥–∏—Ç–µ–ª—è ‚Äî –§–ò–û, –≤–æ–∑—Ä–∞—Å—Ç, –º–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è.
üóÇ –ö—É–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è: –ê—Ä—Ö–∏–≤ –ó–ê–ì–° —Ä–µ–≥–∏–æ–Ω–∞ —Ä–æ–∂–¥–µ–Ω–∏—è.
‚ö†Ô∏è –£—Å–ª–æ–≤–∏–µ: –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–æ–¥—Å—Ç–≤–æ.
üí∞ –¢–∞—Ä–∏—Ñ: 350‚Äì400 ‚ÇΩ | ‚è≥ –°—Ä–æ–∫: 7‚Äì30 –¥–Ω–µ–π

üîê –®–∞–≥ 2. –ó–∞–ø—Ä–æ—Å –≤ –§–°–ò–ù / –ú–í–î –ø–æ —Ñ–∞–∫—Ç—É –æ—Å—É–∂–¥–µ–Ω–∏—è
üìå –ü–æ—á–µ–º—É: –≤ —É–≥–æ–ª–æ–≤–Ω–æ–º –¥–µ–ª–µ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑–∞–Ω—ã —Ä–æ–¥–∏—Ç–µ–ª–∏, –º–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è, –∞–Ω–∫–µ—Ç–∞, –ø—Ä–∏–≥–æ–≤–æ—Ä.
üóÇ –ö—É–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è:
‚Ä¢ –§–°–ò–ù –†–æ—Å—Å–∏–∏,
‚Ä¢ –ê—Ä—Ö–∏–≤ –ú–í–î —Ä–µ–≥–∏–æ–Ω–∞ –æ—Ç–±—ã–≤–∞–Ω–∏—è —Å—Ä–æ–∫–∞.

üè° –®–∞–≥ 3. –°–ø—Ä–∞–≤–∫–∏ –ø–æ –º–µ—Å—Ç—É —Å–º–µ—Ä—Ç–∏
üìå –ß—Ç–æ –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å:
‚Ä¢ –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Å–º–µ—Ä—Ç–∏ ‚Äî –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–µ—Å—Ç–æ —Ä–æ–∂–¥–µ–Ω–∏—è, –≤–æ–∑—Ä–∞—Å—Ç, —Ä–æ–¥–∏—Ç–µ–ª–µ–π.
‚Ä¢ –î–æ–º–æ–≤—ã–µ –∫–Ω–∏–≥–∏, –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–ø–∏—Å–∫–∏ ‚Äî –≤ –∞—Ä—Ö–∏–≤–µ.

ü™™ –®–∞–≥ 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—ã:
‚Ä¢ üîó –û–ë–î ¬´–ú–µ–º–æ—Ä–∏–∞–ª¬ª ‚Äî https://obd-memorial.ru
‚Ä¢ üîó –ü–∞–º—è—Ç—å –Ω–∞—Ä–æ–¥–∞ ‚Äî https://pamyat-naroda.ru
‚Ä¢ üîó –ü–æ–¥–≤–∏–≥ –Ω–∞—Ä–æ–¥–∞ ‚Äî https://podvignaroda.ru
‚Ä¢ üîó –ê—Ä—Ö–∏–≤ –Ø–Ω–¥–µ–∫—Å–∞ ‚Äî –ø–æ–∏—Å–∫ –ø–æ —Ñ–∞–º–∏–ª–∏–∏

üß¨ –®–∞–≥ 5. –î–ù–ö-—Ç–µ—Å—Ç (–µ—Å–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç)
üìå –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º:
‚Ä¢ Y-—Ö—Ä–æ–º–æ—Å–æ–º–∞ (–¥–ª—è –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏),
‚Ä¢ –ó–∞–≥—Ä—É–∑–∫–∞ –≤ GEDmatch, MyHeritage, FamilyTreeDNA.

üì¨ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ rodoslovnaya.pro,
–Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ predki@rodoslovnaya.pro
–∏–ª–∏ –≤ Telegram: @rodoslovnaya_pro
    """,

    "—Ä–∞—Å–∫—É–ª–∞—á–µ–Ω–Ω—ã–µ": """
üß† Rodoslovnaya.pro —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç:

1. –ü–æ–∏—Å–∫ –≤ –∞—Ä—Ö–∏–≤–∞—Ö –ø–æ –¥–µ–ª–∞–º –æ —Ä–∞—Å–∫—É–ª–∞—á–∏–≤–∞–Ω–∏–∏
üìå –ö—É–¥–∞: –ì–æ—Å–∞—Ä—Ö–∏–≤ –æ–±–ª–∞—Å—Ç–∏ —Ä–æ–∂–¥–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ì–ê–°–û, –ì–ê–¢–û).
üìé –î–æ–∫—É–º–µ–Ω—Ç—ã: –∞–Ω–∫–µ—Ç—ã, —Å–ø–∏—Å–∫–∏, –æ–ø–∏—Å–∏ –∏–º—É—â–µ—Å—Ç–≤–∞, –¥–æ–ø—Ä–æ—Å—ã.
üí° –í –Ω–∏—Ö —á–∞—Å—Ç–æ —É–∫–∞–∑–∞–Ω—ã —Ä–æ–¥–∏—Ç–µ–ª–∏, –±—Ä–∞—Ç—å—è, —Å–æ—Å–µ–¥–∏.

2. –ú–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–Ω–∏–≥–∏ –∏ –∏—Å–ø–æ–≤–µ–¥–Ω—ã–µ –≤–µ–¥–æ–º–æ—Å—Ç–∏
üìå –ì–¥–µ: –ø—Ä–∏—Ö–æ–¥—ã –¥–µ—Ä–µ–≤–Ω–∏, –≥–¥–µ –∂–∏–ª –ø—Ä–µ–¥–æ–∫.
üìé FamilySearch.org ‚Äî –º–Ω–æ–≥–æ –æ—Ü–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.

3. –†–µ–≤–∏–∑—Å–∫–∏–µ —Å–∫–∞–∑–∫–∏ (1850‚Äì1858 –≥–≥.)
üìå –ì–¥–µ: –ì–ê–°–û, –ì–ê–¢–û, fgurgia.ru
üí° –ü–æ–∑–≤–æ–ª—è—é—Ç –ø—Ä–æ–π—Ç–∏ –Ω–∞ 2‚Äì3 –ø–æ–∫–æ–ª–µ–Ω–∏—è –Ω–∞–∑–∞–¥.

4. –í–æ–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–µ—Å–ª–∏ –±—ã–ª –≤ –í–û–í)
üìå –ì–¥–µ:
‚Ä¢ –ü–∞–º—è—Ç—å –Ω–∞—Ä–æ–¥–∞ ‚Äî https://pamyat-naroda.ru
‚Ä¢ –ü–æ–¥–≤–∏–≥ –Ω–∞—Ä–æ–¥–∞ ‚Äî https://podvignaroda.ru
‚Ä¢ –¶–ê–ú–û ‚Äî –¥–ª—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

üß¨ –î–ù–ö-—Ç–µ—Å—Ç ‚Äî –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –ø–æ —Ñ–∞–º–∏–ª–∏–∏
üìå Genotek: —Ç–µ—Å—Ç—ã ¬´–ù–∞–≤–∏–≥–∞—Ç–æ—Ä¬ª, ¬´Y-–î–ù–ö¬ª

üì¨ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ rodoslovnaya.pro,
–Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ predki@rodoslovnaya.pro
–∏–ª–∏ –≤ Telegram: @rodoslovnaya_pro
    """,

    "–≤–Ω–µ–±—Ä–∞—á–Ω–æ–µ": """
üß† Rodoslovnaya.pro —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç:

üìå –ï—Å–ª–∏ –æ—Ç—Ü–æ–≤—Å—Ç–≤–æ –Ω–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ ‚Äî –µ—Å–ª–∏ –æ—Ç–µ—Ü —É–∫–∞–∑–∞–Ω, —ç—Ç–æ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

2. –ó–∞–ø—Ä–æ—Å–∏—Ç–µ —Å–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Å–º–µ—Ä—Ç–∏ ‚Äî –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–≤–µ–¥–µ–Ω–∏—è –æ –¥–µ—Ç—è—Ö.

3. –ü–æ–∏—â–∏—Ç–µ –≤ –∞—Ä—Ö–∏–≤–∞—Ö:
‚Ä¢ —Ç—Ä—É–¥–æ–≤—ã–µ –∫–Ω–∏–∂–∫–∏,
‚Ä¢ –∞–¥—Ä–µ—Å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏,
‚Ä¢ –ª–∏—á–Ω—ã–µ –¥–µ–ª–∞.

üß¨ –î–ù–ö-—Ç–µ—Å—Ç ‚Äî –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–æ–¥—Å—Ç–≤–æ:
‚Ä¢ Y-—Ö—Ä–æ–º–æ—Å–æ–º–∞ ‚Äî –¥–ª—è –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏,
‚Ä¢ –ê–≤—Ç–æ-–î–ù–ö ‚Äî –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤.

üìå –†–µ—Å—É—Ä—Å—ã:
‚Ä¢ Genotek ‚Äî https://genotek.ru
‚Ä¢ GEDmatch ‚Äî https://gedmatch.com
‚Ä¢ MyHeritage ‚Äî https://myheritage.ru

üì¨ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ rodoslovnaya.pro,
–Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ predki@rodoslovnaya.pro
–∏–ª–∏ –≤ Telegram: @rodoslovnaya_pro
    """,

    "—Ä–æ–¥–æ—Å–ª–æ–≤–Ω–∞—è": """
üß† Rodoslovnaya.pro —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç:

üìå 1. –ù–∞—á–Ω–∏ —Å –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–∑ –ó–ê–ì–°–∞
üóÇ –ß—Ç–æ –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å:
* –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏
* –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–æ –æ –±—Ä–∞–∫–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π
* –°–ø—Ä–∞–≤–∫—É –æ —Å–º–µ—Ä—Ç–∏
* –°–ø—Ä–∞–≤–∫—É –æ —Å–º–µ–Ω–µ —Ñ–∞–º–∏–ª–∏–∏
‚è≥ –ó–∞–ø–∏—Å–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ó–ê–ì–°–µ 100 –ª–µ—Ç, –ø–æ—Ç–æ–º –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∞—Ä—Ö–∏–≤.
üìÑ –ï—Å–ª–∏ –Ω–µ –ø—Ä–æ—à–ª–æ 100 –ª–µ—Ç ‚Äî –Ω—É–∂–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–µ —Ä–æ–¥—Å—Ç–≤–æ.
üì¨ –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –º–æ–∂–Ω–æ:
* –≤ –º–µ—Å—Ç–Ω—ã–π –ó–ê–ì–°,
* –ª–∏–±–æ —á–µ—Ä–µ–∑ –ì–æ—Å—É—Å–ª—É–≥–∏, –ú–§–¶.
üí∞ –ü—Ä–∏–º–µ—Ä–Ω—ã–π —Ç–∞—Ä–∏—Ñ: 350‚Äì400 ‚ÇΩ –∑–∞ —Å–ø—Ä–∞–≤–∫—É
‚è± –°—Ä–æ–∫: –æ—Ç 7 –¥–æ 30 –¥–Ω–µ–π

üèõ 2. –ê—Ä—Ö–∏–≤—ã —Ä–µ–≥–∏–æ–Ω–∞
üìÅ –í –∞—Ä—Ö–∏–≤–µ –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å:
* –ø–æ–¥–æ–º–æ–≤—ã–µ –∫–Ω–∏–≥–∏,
* –∞–¥—Ä–µ—Å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏,
* –¥–æ–∫—É–º–µ–Ω—Ç—ã –æ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏ —É—á–µ–±–µ
üåê –°–∞–π—Ç –∞—Ä—Ö–∏–≤–∞: —É—Ç–æ—á–Ω–∏—Ç–µ –ø–æ —Ä–µ–≥–∏–æ–Ω—É
üí≥ –î–æ—Å—Ç—É–ø –∫ —Ü–∏—Ñ—Ä–æ–≤—ã–º –∫–æ–ø–∏—è–º ‚Äî –æ—Ç ~90 ‚ÇΩ –≤ —Å—É—Ç–∫–∏

üß≠ 3. –û–Ω–ª–∞–π–Ω-—Ä–µ—Å—É—Ä—Å—ã
* üîó –ê—Ä—Ö–∏–≤ –Ø–Ω–¥–µ–∫—Å–∞ ‚Äî https://yandex.ru/collections
* üîó –§–æ—Ä—É–º –í–ì–î ‚Äî https://forum.vgd.ru
* üîó –ê—Ä—Ö–∏–≤—ã.—Ä—É ‚Äî https://arhivy.ru

üì¨ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ rodoslovnaya.pro,
–Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ predki@rodoslovnaya.pro
–∏–ª–∏ –≤ Telegram: @rodoslovnaya_pro
    """,

    "–æ–±—â–∏–π": """
üß† Rodoslovnaya.pro —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç:

üìå –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –Ω–∞—á–∞—Ç—å —Å:
1. –°–≤–∏–¥–µ—Ç–µ–ª—å—Å—Ç–≤–∞ –æ —Ä–æ–∂–¥–µ–Ω–∏–∏ (—á–µ—Ä–µ–∑ –ó–ê–ì–° –∏–ª–∏ –∞—Ä—Ö–∏–≤)
2. –ü–æ–∏—Å–∫–∞ –≤ –û–ë–î ¬´–ú–µ–º–æ—Ä–∏–∞–ª¬ª, ¬´–ü–∞–º—è—Ç—å –Ω–∞—Ä–æ–¥–∞¬ª, ¬´–ü–æ–¥–≤–∏–≥ –Ω–∞—Ä–æ–¥–∞¬ª
3. –ü—Ä–æ–≤–µ—Ä–∫–∏ –º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –∫–Ω–∏–≥ –∏ —Ä–µ–≤–∏–∑—Å–∫–∏—Ö —Å–∫–∞–∑–æ–∫
4. –î–ù–ö-—Ç–µ—Å—Ç–∞ (Genotek) –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤

üí∞ –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã:
‚Ä¢ –°–ø—Ä–∞–≤–∫–∞ –∏–∑ –ó–ê–ì–°: 350‚Äì400 ‚ÇΩ
‚Ä¢ –î–æ—Å—Ç—É–ø –∫ –∞—Ä—Ö–∏–≤–∞–º: –æ—Ç 90 ‚ÇΩ/—Å—É—Ç–∫–∏
‚Ä¢ –ê–Ω–∞–ª–æ–≥–æ–≤—ã–π –ø–æ–∏—Å–∫: –æ—Ç 500 ‚ÇΩ –∑–∞ –∑–∞–ø—Ä–æ—Å

üìö –ì–ª—É–±–∏–Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
‚Ä¢ –ó–ê–ì–° ‚Äî —Å 1920-—Ö
‚Ä¢ –ú–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ –∫–Ω–∏–≥–∏ ‚Äî —Å 1720-—Ö –¥–æ 1917
‚Ä¢ –ò—Å–ø–æ–≤–µ–¥–Ω—ã–µ –≤–µ–¥–æ–º–æ—Å—Ç–∏ ‚Äî –¥–æ 1880-—Ö
‚Ä¢ –†–µ–≤–∏–∑—Å–∫–∏–µ —Å–∫–∞–∑–∫–∏ ‚Äî –¥–æ 1858 –≥.

üì¨ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ rodoslovnaya.pro,
–Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ predki@rodoslovnaya.pro
–∏–ª–∏ –≤ Telegram: @rodoslovnaya_pro
    """
}

# –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–µ–π—Å–∞
def classify_case(text):
    text = text.lower()
    if any(k in text for k in ["–∞—Ä–µ—Å—Ç–æ–≤–∞–Ω", "—Ä–∞—Å—Å—Ç—Ä–µ–ª—è–Ω", "—Ä–µ–∞–±–∏–ª–∏—Ç–∏—Ä–æ–≤–∞–Ω", "—Ç—Ä–æ–π–∫–∞", "–Ω–∫–≤–¥", "–∫-—Ä", "—à–ø–∏–æ–Ω"]):
        return "—Ä–µ–ø—Ä–µ—Å—Å–∏–∏"
    elif any(k in text for k in ["–ø–ª–µ–Ω", "—à—Ç–∞–ª–∞–≥", "–æ—Ñ–ª–∞–≥", "arolsen", "wast", "–≤–æ–µ–Ω–Ω–æ–ø–ª–µ–Ω–Ω—ã–π"]):
        return "–ø–ª–µ–Ω"
    elif any(k in text for k in ["–æ—Å—É–∂–¥—ë–Ω", "—É–≥–æ–ª–æ–≤–Ω–æ–µ –¥–µ–ª–æ", "—Å—Ä–æ–∫", "—Ç—é—Ä—å–º–∞", "–º—É—Ä–º–∞—à–∏"]):
        return "–æ—Å—É–∂–¥—ë–Ω"
    elif any(k in text for k in ["–∫—É–ª–∞–∫", "—Ä–∞—Å–∫—É–ª–∞—á–µ–Ω—ã", "—Å–ø–µ—Ü–ø–µ—Ä–µ—Å–µ–ª–µ–Ω–∏–µ"]):
        return "—Ä–∞—Å–∫—É–ª–∞—á–µ–Ω–Ω—ã–µ"
    elif any(k in text for k in ["–≤–Ω–µ–±—Ä–∞—á–Ω—ã–π", "–Ω–µ –±—ã–ª –∂–µ–Ω–∞—Ç", "–æ—Ç—Ü–æ–≤—Å—Ç–≤–æ", "—Ä–æ–¥–∏–ª—Å—è –æ—Ç"]):
        return "–≤–Ω–µ–±—Ä–∞—á–Ω–æ–µ"
    elif "—Ä–æ–¥–æ—Å–ª–æ–≤–Ω–∞—è" in text or "–ø—Ä–µ–¥–∫–∏" in text:
        return "—Ä–æ–¥–æ—Å–ª–æ–≤–Ω–∞—è"
    else:
        return "–æ–±—â–∏–π"

# Google Sheets
def save_to_google_sheets(data):
    try:
        print("‚úÖ 1. –ù–∞—á–∏–Ω–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Google –¢–∞–±–ª–∏—Ü—É...")
        scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]
        print("‚úÖ 2. –ó–∞–≥—Ä—É–∂–∞–µ–º —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ...")

        # –ü–æ–ª—É—á–∞–µ–º JSON –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
        json_creds = os.getenv("GOOGLE_CREDENTIALS")
        if not json_creds:
            raise EnvironmentError("–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è GOOGLE_CREDENTIALS –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

        creds_dict = json.loads(json_creds)
        print("‚úÖ 3. JSON —É—Å–ø–µ—à–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω")

        creds = ServiceAccountCredentials.from_json_keyfile_dict(creds_dict, scope)
        print("‚úÖ 4. –£—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã")

        client = gspread.authorize(creds)
        print("‚úÖ 5. –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ Google Sheets API")

        sheet = client.open_by_url(os.getenv("GOOGLE_SHEET_URL")).sheet1
        print("‚úÖ 6. –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ —Ç–∞–±–ª–∏—Ü–µ")

        row = [
            datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
            data.get("fio"),
            data.get("dates"),
            data.get("region"),
            data.get("known"),
            data.get("goal"),
            data.get("contact"),
            data.get("case_type"),
            data.get("recommendations") 
        ]
        sheet.append_row(row)
        print("‚úÖ 7. –î–ê–ù–ù–´–ï –£–°–ü–ï–®–ù–û –î–û–ë–ê–í–õ–ï–ù–´ –í –¢–ê–ë–õ–ò–¶–£!")
    except Exception as e:
        print(f"‚ùå –û–®–ò–ë–ö–ê: {e}")
        import traceback
        traceback.print_exc()
# –ö–æ–º–∞–Ω–¥–∞ /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "üëã –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî –±–æ—Ç –ø—Ä–æ–µ–∫—Ç–∞ Rodoslovnaya.pro.\n"
        "–ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Ç–µ–±–µ –≤ –ø–æ–∏—Å–∫–µ –ø—Ä–µ–¥–∫–æ–≤.\n"
        "–ù–∞–ø–∏—à–∏ –§–ò–û –ø—Ä–µ–¥–∫–∞, –∏—Å—Ç–æ—Ä–∏—é –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—á–µ—à—å –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å."
    )
    return STEP_FIO

async def handle_fio(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data["fio"] = update.message.text
    await update.message.reply_text("üìÜ –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –≥–æ–¥—ã –∂–∏–∑–Ω–∏?")
    return STEP_DATES

async def handle_dates(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data["dates"] = update.message.text
    await update.message.reply_text("üìç –ì–¥–µ –∂–∏–ª –ø—Ä–µ–¥–æ–∫?")
    return STEP_REGION

async def handle_region(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data["region"] = update.message.text
    await update.message.reply_text("üìÑ –ß—Ç–æ —Ç—ã —É–∂–µ –∑–Ω–∞–µ—à—å –æ –Ω—ë–º?")
    return STEP_KNOWN

async def handle_known(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data["known"] = update.message.text
    await update.message.reply_text("üîç –ß—Ç–æ —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å?")
    return STEP_GOAL

async def handle_goal(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data["goal"] = update.message.text
    await update.message.reply_text("üì¨ –û—Å—Ç–∞–≤—å Telegram –∏–ª–∏ email –¥–ª—è —Å–≤—è–∑–∏:")
    return STEP_CONTACT

async def handle_contact(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data["contact"] = update.message.text
    data = context.user_data
    case_type = classify_case(f"{data['known']} {data['goal']}")
    data["case_type"] = case_type

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
    response = CASE_TEMPLATES.get(case_type, CASE_TEMPLATES["–æ–±—â–∏–π"])
    final_response = f"üß† –°–æ–≤–µ—Ç –æ—Ç Rodoslovnaya.pro:\n\n{response}\n\nüì¨ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?..."

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
    await update.message.reply_text(final_response)

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –í–°–Å, –≤–∫–ª—é—á–∞—è –æ—Ç–≤–µ—Ç
    save_to_google_sheets({
        "fio": data.get("fio"),
        "dates": data.get("dates"),
        "region": data.get("region"),
        "known": data.get("known"),
        "goal": data.get("goal"),
        "contact": data.get("contact"),
        "case_type": case_type,
        "recommendations": response  # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    })

    return ConversationHandler.END

def main():
    TOKEN = os.getenv("TELEGRAM_TOKEN")
    if not TOKEN:
        logger.error("–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é TELEGRAM_TOKEN")
        return

    app = Application.builder().token(TOKEN).build()

    conv_handler = ConversationHandler(
        entry_points=[CommandHandler("start", start)],
        states={
            STEP_FIO: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_fio)],
            STEP_DATES: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_dates)],
            STEP_REGION: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_region)],
            STEP_KNOWN: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_known)],
            STEP_GOAL: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_goal)],
            STEP_CONTACT: [MessageHandler(filters.TEXT & ~filters.COMMAND, handle_contact)],
        },
        fallbacks=[]
    )

    app.add_handler(conv_handler)
    app.run_polling()

if __name__ == "__main__":
    main()
